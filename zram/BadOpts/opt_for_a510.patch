From dbad06ed5157692fedc96bf25fc53480fbb9d4e8 Mon Sep 17 00:00:00 2001
From: ztc1997 <dev@ztc1997.com>
Date: Wed, 22 May 2024 21:17:02 +0800
Subject: [PATCH] arm64: Optimize compiler for cortex-a510

Change-Id: I37b7e947f0e0607ba4ca5e9311d4c95f92e75ad8
---
 arch/arm64/Makefile | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/arch/arm64/Makefile b/arch/arm64/Makefile
index be67de3d5839..1384d7feec8b 100644
--- a/arch/arm64/Makefile
+++ b/arch/arm64/Makefile
@@ -36,6 +36,10 @@ ifeq ($(CONFIG_BROKEN_GAS_INST),y)
 $(warning Detected assembler with broken .inst; disassembly will be unreliable)
 endif
 
+ifeq ($(shell test $(CONFIG_CLANG_VERSION) -gt 130000 2>/dev/null; echo $$?),0)
+KBUILD_CFLAGS	+= -mcpu=cortex-a510
+endif
+
 KBUILD_CFLAGS	+= -mgeneral-regs-only	\
 		   $(compat_vdso) $(cc_has_k_constraint)
 KBUILD_CFLAGS	+= $(call cc-disable-warning, psabi)
